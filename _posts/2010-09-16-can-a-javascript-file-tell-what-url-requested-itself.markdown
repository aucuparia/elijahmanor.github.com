---
layout: post
title: Can a JavaScript file tell what URL requested itself?
date: '2010-09-16 03:50:00'
---

<p><img alt="" src="http://gyazo.com/138f24ea7f71647fcb5803deeecf111b.png" width="586" height="275"></p>  <p>I've been working on a project recently where I'm appending the current date to the end of script files so that they won't be cached.</p>  <p>I'm surrounding the code with lots of Unit Tests and I was trying to figure out the best way I could test that the script was actually loaded with the appended timestamp.</p>  <p>How could a JavaScript file tell what URL requested itself? Could the script know what URL make itself load?</p>  <p>Initially I was thinking location.href, but that ends up being the URL of the page the script was loaded on, not the script URL itself. Someone else suggested document.referrer, but that turns out to be the URL that referred the current page.</p>  <p>After a little time passed and several tweets passed by my stream, the correct answer flowed by...</p>  <p>Thanks to <a href="http://twitter.com/cowboy" target="_blank">@cowboy</a> <a href="http://twitter.com/InfinitiesLoop" target="_blank">@InfinitiesLoop</a> <a href="http://twitter.com/ashitvora" target="_blank">@ashitvora</a> for the answer and it is sooooo cleaver! </p>  <p><span><span>var </span><span>scripts </span><span>= </span><span>document</span><span>.</span><span>getElementsByTagName</span><span>( </span><span>"script" </span><span>)</span><span>;</span>      <br><span>var </span><span>lastScript </span><span>= </span><span>scripts</span><span>[</span><span>scripts</span><span>.</span><span>length </span><span>- </span><span>1</span><span>]</span><span>;</span>      <br><span>alert</span><span>( </span><span>lastScript</span><span>.</span><span>src </span><span>)</span><span>;</span><span>â€‹</span></span></p>  <p>Since the script files execute in order, if you grab the scripts on the document while you are executing, then the last script listed should be the one you are currently in!</p>  <p>This question has been asked on stackoverflow as well ;)</p>  <ul><li><a href="http://stackoverflow.com/questions/2255689/how-to-get-the-file-path-of-the-currenctly-executing-javascript-code">How to get the file-path of the currenctly executing javascript code</a></li>    <li><a href="http://www.elijahmanor.com/Can%20code%20in%20a%20Javascript%20file%20know%20its%20own%20domain/URL">Can code in a Javascript file know its own domain/URL</a></li> </ul><p>As it turns out, the above technique only works for pages that have the <script> tag manually declared. If you dynamically inject your <script> tags programmatically, then the above technique doesn't work correctly. For my scenario to work, I had to tweak the solution a little bit.</p>  <p>Fortunately, I knew what file I was in, so I could do some partial matching to grab the script tag on the page to look at the src.</p>  <p><span><span>alert</span><span>( </span><span>$</span><span>(</span><span>"script[src*=sourcefile1.js]"</span><span>)</span><span>.</span><span>attr</span><span>(</span><span>"src"</span><span>) </span><span>)</span><span>;</span></span></p>  <p>The above code depends on jQuery, but I already have it loaded by this point, so it works out fine ;)</p>  <p>Thanks to everyone who helped me along in this fun and interesting problem.</p>